<%- include("../partials/admin/header", { active: "orders" }) %>

<!-- üî¥ NOTHING ELSE FROM DASHBOARD HERE -->

<!-- ===== MODAL ROOT (OUTSIDE DASHBOARD FLOW) ===== -->
<div id="admin-modal-root">

  <div class="order-details-overlay" onclick="window.history.back()"></div>

  <div class="order-details-modal">

    <button class="btn-close" onclick="window.history.back()">‚úï</button>

    <div class="modal-header">
      <h2>üì¶ Order Details</h2>
    </div>

    <div class="header-grid">
      <div>
        <span class="label">Order ID</span>
        <span class="value"><%= order._id %></span>
      </div>
      <div>
        <span class="label">Placed On</span>
        <span class="value"><%= order.createdAt.toDateString() %></span>
      </div>
      <div>
        <span class="label">Payment</span>
        <span class="value"><%= order.paymentMethod %></span>
      </div>
    </div>

    <div class="section">
      <h3>üë§ Customer</h3>
      <p><strong>Name:</strong> <%= order.userId.name %></p>
      <p><strong>Email:</strong> <%= order.userId.email %></p>
      <p><strong>Phone:</strong> <%= order.userId.phone %></p>
      <div class="address">
        <%= order.address.street %>,
        <%= order.address.city %>,
        <%= order.address.state %> - <%= order.address.pincode %>
      </div>
    </div>

    <div class="section">
      <h3>üõç Products</h3>

      <% order.products.forEach((item, index) => { %>
        <div class="product-card">

          <img src="<%= item.productId.images?.[0] || '/placeholder.png' %>" />

          <div class="product-info">
            <h4><%= item.productId.name %></h4>
            <p>Qty: <%= item.quantity %></p>
            <p>‚Çπ<%= item.price %></p>
            <p class="total">‚Çπ<%= item.quantity * item.price %></p>
          </div>

          <form method="POST" action="/admin/orders/<%= order._id %>/update-product-status">
            <input type="hidden" name="productIndex" value="<%= index %>">
            <select name="status" onchange="this.form.submit()">
              <% ["Pending","Processing","Shipped","Delivered","Cancelled"].forEach(s => { %>
                <option value="<%= s %>" <%= item.status === s ? "selected" : "" %>>
                  <%= s %>
                </option>
              <% }) %>
            </select>
          </form>

        </div>
      <% }) %>
    </div>

    <div class="section">
      <h3>üí≥ Payment Summary</h3>
      <div class="summary">
        <div><span>Subtotal</span><span>‚Çπ<%= order.totalPrice %></span></div>
        <div><span>Delivery</span><span>‚Çπ<%= order.deliveryCharges %></span></div>
        <div><span>Platform</span><span>‚Çπ<%= order.platformFee %></span></div>
        <div class="grand"><span>Total</span><span>‚Çπ<%= order.grandTotal %></span></div>
      </div>
    </div>

  </div>
</div>
