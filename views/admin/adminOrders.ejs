<%- include("../partials/admin/header", { active: "orders" }) %>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Orders | Quora</title>
  <link rel="stylesheet" href="/css/admin-orders.css" />
</head>

<body>
<div class="layout">
  <main class="content">

    <!-- HEADER -->
    <div class="header-section">
      <h2>Orders</h2>

      <!-- SEARCH -->
      <form class="search-box" method="GET" action="/admin/orders">
        <div style="position: relative;">
          <input
            type="text"
            name="search"
            placeholder="Search orders"
            value="<%= search || '' %>"
          />

          <% if (search) { %>
            <a href="/admin/orders" class="clear-search">‚úñ</a>
          <% } %>
        </div>

        <button type="submit">üîç</button>
      </form>
    </div>

    <!-- STATUS FILTER TABS -->
    <div class="status-tabs">
      <% 
        const statuses = [
          "All",
          "Placed",
          "Processing",
          "Out for Delivery",
          "Delivered",
          "Cancelled",
          "Payment Failed"
        ]; 
      %>

      <% statuses.forEach(s => { %>
        <a
          href="?status=<%= s %>&search=<%= search || '' %>"
          class="tab <%= status === s ? 'active' : '' %>"
        >
          <%= s %>
        </a>
      <% }) %>
    </div>

    <!-- TABLE -->
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Product</th>
            <th>Order ID</th>
            <th>Date</th>
            <th>Customer</th>
            <th>Status</th>
            <th>Price</th>
            <th>View</th>
          </tr>
        </thead>

        <tbody>
        <% if (!orders || orders.length === 0) { %>
          <tr>
            <td colspan="7" class="no-orders">No orders found</td>
          </tr>
        <% } else { %>

          <% orders.forEach(order => { %>
            <tr>
              <!-- PRODUCT -->
              <td data-label="Product" class="product-cell">
                <% if (order.products && order.products.length > 0) { %>
                  <span class="product-name">
                    <%= 
                      order.products[0].productId?.productName ||
                      order.products[0].productId?.title ||
                      order.products[0].productId?.name ||
                      "Product"
                    %>
                  </span>

                  <% if (order.products.length > 1) { %>
                    <span class="more">
                      + <%= order.products.length - 1 %> more
                    </span>
                  <% } %>
                <% } else { %>
                  <span>N/A</span>
                <% } %>
              </td>

              <!-- ORDER ID -->
              <td data-label="Order ID">
                <%= order._id %>
              </td>

              <!-- DATE -->
              <td data-label="Date">
                <%= new Date(order.createdAt).toLocaleDateString() %>
              </td>

              <!-- CUSTOMER -->
              <td data-label="Customer">
                <%= order.userId?.name || "N/A" %>
              </td>

              <!-- STATUS -->
              <td data-label="Status">
                <span class="status <%= order.status.toLowerCase().replace(/\s/g,'-') %>">
                  <%= order.status %>
                </span>
              </td>

              <!-- PRICE -->
              <td data-label="Price">
                ‚Çπ <%= order.totalAmount %>
              </td>

              <!-- VIEW -->
              <td data-label="View">
                <a href="/admin/orders/<%= order._id %>" class="btn-view">
                  View
                </a>
              </td>
            </tr>
          <% }) %>

        <% } %>
        </tbody>
      </table>
    </div>

    <!-- PAGINATION -->
    <div class="pagination">
      <div class="show">
        Show result
        <select onchange="location.href='?page=1&limit=' + this.value + '&search=<%= search || '' %>&status=<%= status || 'All' %>'">
          <option value="5"  <%= limit == 5  ? "selected" : "" %>>5</option>
          <option value="10" <%= limit == 10 ? "selected" : "" %>>10</option>
          <option value="20" <%= limit == 20 ? "selected" : "" %>>20</option>
        </select>
      </div>

      <div class="pages">
        <% if (currentPage > 1) { %>
          <a href="?page=<%= currentPage - 1 %>&limit=<%= limit %>&search=<%= search || '' %>&status=<%= status || 'All' %>">‚Äπ</a>
        <% } %>

        <% for (let i = 1; i <= totalPages; i++) { %>
          <a
            href="?page=<%= i %>&limit=<%= limit %>&search=<%= search || '' %>&status=<%= status || 'All' %>"
            class="<%= i === currentPage ? 'active' : '' %>"
          >
            <%= i %>
          </a>
        <% } %>

        <% if (currentPage < totalPages) { %>
          <a href="?page=<%= currentPage + 1 %>&limit=<%= limit %>&search=<%= search || '' %>&status=<%= status || 'All' %>">‚Ä∫</a>
        <% } %>
      </div>
    </div>

  </main>
</div>
</body>
</html>
