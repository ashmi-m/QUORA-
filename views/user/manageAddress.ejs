

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Addresses</title>
  <link rel="stylesheet" href="/css/manageAddress.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<div class="profile-container">
  <div class="address-wrapper">

    <div class="address-header">
      <h2>Manage Addresses</h2>
      <a href="/add-address" class="add-address-btn">+ Add New Address</a>
    </div>

    <% if (!addresses || addresses.length === 0) { %>
      <p>No address found</p>
    <% } %>

    <% addresses.forEach(addr => { %>
      <div class="address-card" id="address-<%= addr._id %>">

        <div class="address-info">
          <div class="address-left">
            <div class="address-name">
              <%= addr.name ? addr.name.toUpperCase() : "NAME" %>
            </div>

            <div class="address-phone">
              <%= addr.phone || addr.mobile || addr.phoneNumber || "NO NUMBER" %>
            </div>

          </div>
          <div class="address-actions">
            <button class="dots-btn">â‹®</button>
            <div class="dropdown-menu">
              <a href="/edit-address/<%= addr._id %>" class="edit-btn">Edit</a>
              <button class="delete-btn" data-id="<%= addr._id %>">Delete</button>
            </div>
          </div>

        </div>

        <p class="address-text">
          <%= addr.address %>, <%= addr.city %>, <%= addr.state %> - <%= addr.pincode %>
        </p>

 <span class="address-type">
      <%= addr.addressType %>  
    </span>

      </div>
    <% }) %>

  </div>
</div>

<script>
document.addEventListener("click", e => {
  if (e.target.classList.contains("dots-btn")) {
    e.stopPropagation();
    document.querySelectorAll(".dropdown-menu")
      .forEach(menu => menu.classList.remove("show"));
    e.target.nextElementSibling.classList.toggle("show");
  } else {
    document.querySelectorAll(".dropdown-menu")
      .forEach(menu => menu.classList.remove("show"));
  }
});

document.querySelectorAll(".delete-btn").forEach(btn => {
  btn.addEventListener("click", async () =>{
    const id = btn.dataset.id;

    const confirm = await Swal.fire({
      title: "Delete address?",
      text: "This action cannot be undone",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#d33",
      cancelButtonColor: "#3085d6",
      confirmButtonText: "Delete"
    });

    if (confirm.isConfirmed) {
      const res = await fetch(`/address/delete/${id}`, { method: "DELETE" });
      const data = await res.json();

      if (data.success) {
        document.getElementById(`address-${id}`).remove();
        Swal.fire("Deleted!", "Address removed", "success");
      } else {
        Swal.fire("Error", "Delete failed", "error");
      }
    }
  });
});
</script>

</body>
</html>

