

<%- include("../partials/user/header") %>

<link rel="stylesheet" href="/css/address.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="account-page">

  <!-- SIDEBAR -->
  <aside class="account-sidebar">
    <div class="user-info">
      <p>Hello ðŸ‘‹ <b><%= user.name %></b></p>
    </div>

    <ul class="menu">
      <li><a href="/userprofile">Profile Information</a></li>
      <li><a href="/userprofile#ordersSection">My Orders</a></li>
      <li><a href="/logout">Log out</a></li>
    </ul>
  </aside>

  <!-- CONTENT -->
  <main class="account-content">

    <div class="address-card">
      <h3 class="card-title">Add a new address</h3>

      <form id="addressForm" action="/address/add" method="POST">

        <div class="form-row">
          <div class="form-group">
            <label>Name</label>
            <input name="name" required>
          </div>

          <div class="form-group">
            <label>Mobile Number</label>
            <input name="mobile" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Pincode</label>
            <input name="pincode" required>
          </div>

          <div class="form-group">
            <label>Locality</label>
            <input name="locality" required>
          </div>
        </div>

        <div class="form-group">
          <label>Address</label>
          <textarea name="address" required></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input name="city" required>
          </div>

          <div class="form-group">
            <label>State</label>
            <select name="state" required>
              <option value="">-- Select state --</option>
              <option>Kerala</option>
              <option>Tamil Nadu</option>
              <option>Karnataka</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Landmark (optional)</label>
          <input name="landmark">
        </div>

        <div class="address-type">
          <label><input type="radio" name="type" value="Home" checked> Home</label>
          <label><input type="radio" name="type" value="Work"> Work</label>
        </div>

        <div class="btn-row">
          <button class="save-btn">Save</button>
          <a href="/manage-address" class="cancel-btn">Cancel</a>
        </div>

      </form>
    </div>
  </main>
</div>

<script>

document.getElementById("addressForm").addEventListener("submit", e => {
  const mobile = document.querySelector("[name='mobile']").value.trim();
  const pincode = document.querySelector("[name='pincode']").value.trim();

  if (!/^\d{10}$/.test(mobile)) {
    e.preventDefault();
    Swal.fire("Invalid Mobile", "Enter a valid 10-digit mobile number", "error");
    return;
  }

  if (!/^\d{6}$/.test(pincode)) {
    e.preventDefault();
    Swal.fire("Invalid Pincode", "Enter a valid 6-digit pincode", "error");
    return;
  }
});


const params = new URLSearchParams(window.location.search);
if (params.get("saved") === "true") {
  Swal.fire({
    icon: "success",
    title: "Saved!",
    text: "Address added successfully",
    timer: 2000,
    showConfirmButton: false
  }).then(() => {
    window.history.replaceState({}, document.title, "/add-address");
  });
}
</script>
