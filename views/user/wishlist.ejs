

<%- include("../partials/user/header") %>

<link rel="stylesheet" href="/css/wishlist.css">

<div class="breadcrumbs">
  Home &gt; <strong>Wishlist</strong>
</div>

<section class="wishlist-wrapper">
  <h2 class="wishlist-title">My Wishlist</h2>

  <% if (!wishlist || wishlist.length === 0) { %>
    <p class="empty">Your wishlist is empty ‚ù§Ô∏è</p>
  <% } else { %>
    <div class="wishlist-container">
      <% wishlist.forEach(item => { %>
        <% if (!item.productId) return; %>
        <% const product = item.productId; %>

        <div class="wishlist-item">
          <span class="heart wishlist-remove" data-id="<%= product._id %>">‚ù§</span>
          <img src="<%= product.productImage?.[0] || '/images/default.jpg' %>" alt="<%= product.productName %>">

          <div class="details">
            <h3><%= product.productName %></h3>
            <div class="rating">
              ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (<%= product.rating || 4.0 %>)
            </div>
            <div class="price">‚Çπ<%= product.regularPrice %></div>
            <button class="add-to-cart-btn" data-id="<%= product._id %>">
              Add to Cart
            </button>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</section>

<%- include("../partials/user/footer") %>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {


  document.querySelectorAll(".add-to-cart-btn").forEach(btn => {
    btn.addEventListener("click", async () => {
      const productId = btn.dataset.id;
      if (!productId) return;

      try {
        const res = await fetch("/cart/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ productId })
        });

        const data = await res.json();

        if (res.ok) {
          Swal.fire({
            icon: "success",
            title: "Added to Cart",
            text: `${data.productName || "Product"} added successfully!`,
            timer: 1200,
            showConfirmButton: false
          });
           btn.closest(".wishlist-item").remove();

       } else {
  // üî• SMART FEEDBACK
  Swal.fire({
    icon: "info",
    title: "Action Not Allowed",
    text: data.message || "Product already in cart"
  });
}
        

      } catch (err) {
        console.error(err);
        Swal.fire("Error", "Server error", "error");
      }
    });
  });

  
  document.querySelectorAll(".wishlist-remove").forEach(btn => {
    btn.addEventListener("click", async () => {
      const productId = btn.dataset.id;
      if (!productId) return;

      try {
        const res = await fetch("/wishlist/remove", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ productId })
        });

        const data = await res.json();

        if (data.success) {
          Swal.fire({
            icon: "success",
            title: "Removed from Wishlist",
            timer: 1000,
            showConfirmButton: false
          });
         
          btn.closest(".wishlist-item").remove();
        } else {
          Swal.fire("Error", data.message || "Unable to remove", "error");
        }
      } catch (err) {
        console.error(err);
        Swal.fire("Error", "Server error", "error");
      }
    });
  });

});
</script>

